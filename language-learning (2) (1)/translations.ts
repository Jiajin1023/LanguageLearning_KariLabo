import React from 'react';
import type { UiLanguage, Language } from './types';
import { UKFlagIcon, JapanFlagIcon, GermanFlagIcon, ChinaFlagIcon, FrenchFlagIcon, SpanishFlagIcon, ItalianFlagIcon, ArabicFlagIcon } from './components/Icons';

export const languageOptions: { code: Language, name: string, icon: React.FC }[] = [
    { code: 'en', name: 'English', icon: UKFlagIcon },
    { code: 'de', name: 'German', icon: GermanFlagIcon },
    { code: 'fr', name: 'French', icon: FrenchFlagIcon },
    { code: 'es', name: 'Spanish', icon: SpanishFlagIcon },
    { code: 'it', name: 'Italian', icon: ItalianFlagIcon },
    { code: 'ja', name: 'Japanese', icon: JapanFlagIcon },
    { code: 'zh', name: 'Chinese', icon: ChinaFlagIcon },
    { code: 'ar', name: 'Arabic', icon: ArabicFlagIcon },
];

export const languageMap: Record<Language, string> = Object.fromEntries(languageOptions.map(l => [l.code, l.name])) as Record<Language, string>;

type Translations = typeof i18n.en;

const i18n = {
  en: {
    app: {
      title: "Language Learning",
      tagline: "Master {language} with AI",
      footer: "Learn, Quiz, Master.",
      error: "Failed to start session. The AI might be busy, or there could be an issue with your API key. Please try again.",
      loading: "Preparing your session...",
      backToMenu: "Back to Menu",
    },
    menu: {
      title: "Session Setup",
      subtitle: "Choose your settings to begin",
      step1: "Step 1: Choose your languages",
      iWantToLearn: "I want to learn:",
      myAppIsIn: "My app is in:",
      step2: "Step 2: Choose your level",
      step3: "Step 3: Choose a category",
      vocabulary: "Vocabulary",
      grammar: "Grammar",
      pronunciation: "Pronunciation",
      step4: "Step 4: Select a mode",
      learn: "Learn",
      learnItems: "{count} items",
      quiz: "Quiz",
      practice: "Practice",
      practiceItems: "{count} items",
      quizItems: "You choose",
      step5: "Step 5: Set practice length",
      quizLength: "{count} questions",
      startSession: "Start Session",
      A1: 'Beginner',
      A2: 'Elementary',
      B1: 'Intermediate',
      B2: 'Upper-Intermediate',
      C1: 'Advanced',
      All: 'A1-C1',
    },
    learning: {
      imageNotAvailable: "Image not available",
      progress: "{current} / {total}",
      prev: "Prev",
      next: "Next",
    },
    quiz: {
      score: "Score: {score}",
      progress: "{current} / {total}",
      placeholder: "Type the {language} translation",
      check: "Check",
      hint: "Hint",
      hintError: "Could not fetch a hint at this time.",
      correctAnswer: "Correct answer:",
      nextWord: "Next Word",
      finish: "Finish",
      exampleSentence: "Example Sentence",
    },
    pronunciation: {
        score: "Score: {score}",
        progress: "{current} / {total}",
        instruction: "Listen, then record your pronunciation.",
        listen: "Listen",
        record: "Record",
        recording: "Recording...",
        processing: "Processing...",
        speakNow: "Speak now...",
        correct: "Correct!",
        incorrect: "Not quite, try again.",
        correctWordWas: "The word was:",
        youSaid: "You said:",
        nextWord: "Next Word",
        finish: "Finish",
        micError: "Could not access microphone. Please enable microphone permissions in your browser settings.",
        recognitionError: "Sorry, I didn't catch that. Please try again.",
    },
    grammarQuiz: {
        score: "Score: {score}",
        progress: "{current} / {total}",
        generating: "Generating grammar question...",
        questionError: "Could not load the next question. Please try again.",
        tryAgain: "Try Again",
        correctAnswer: "Correct answer:",
        gettingExplanation: "Getting explanation...",
        explanationError: "Could not load an explanation for this error.",
        correct: "Correct!",
        nextQuestion: "Next Question",
        finishQuiz: "Finish Quiz",
    },
    grammarLearn: {
        grammarRuleNotAvailable: "Grammar rule not available",
        progress: "{current} / {total}",
        prev: "Prev",
        next: "Next",
    },
    results: {
      title: "Quiz Complete!",
      perfectMessage: "Perfect Score!",
      excellentMessage: "Excellent Job!",
      goodMessage: "Good Try!",
      practiceMessage: "Keep practicing!",
      score: "Your score: {score} / {total}",
      playAgain: "Play Again",
      emojis: {
          perfect: "ðŸ†",
          excellent: "ðŸ‘",
          good: "ðŸ˜Š",
          practice: "ðŸ’ª",
          default: "ðŸŽ‰",
      }
    }
  },
  de: {
    app: {
      title: "Sprachen lernen",
      tagline: "Meistere {language} mit KI",
      footer: "Lernen, Testen, Meistern.",
      error: "Sitzung konnte nicht gestartet werden. Die KI ist mÃ¶glicherweise beschÃ¤ftigt oder es gibt ein Problem mit Ihrem API-SchlÃ¼ssel. Bitte versuchen Sie es erneut.",
      loading: "Deine Sitzung wird vorbereitet...",
      backToMenu: "ZurÃ¼ck zum MenÃ¼",
    },
    menu: {
      title: "Sitzungseinstellungen",
      subtitle: "WÃ¤hle deine Einstellungen, um zu beginnen",
      step1: "Schritt 1: WÃ¤hle deine Sprachen",
      iWantToLearn: "Ich mÃ¶chte lernen:",
      myAppIsIn: "Meine App ist auf:",
      step2: "Schritt 2: WÃ¤hle dein Niveau",
      step3: "Schritt 3: WÃ¤hle eine Kategorie",
      vocabulary: "Wortschatz",
      grammar: "Grammatik",
      pronunciation: "Aussprache",
      step4: "Schritt 4: WÃ¤hle einen Modus",
      learn: "Lernen",
      learnItems: "{count} Elemente",
      quiz: "Quiz",
      practice: "Ãœben",
      practiceItems: "{count} Elemente",
      quizItems: "Du wÃ¤hlst",
      step5: "Schritt 5: ÃœbungslÃ¤nge festlegen",
      quizLength: "{count} Fragen",
      startSession: "Sitzung starten",
      A1: 'AnfÃ¤nger',
      A2: 'Grundlegend',
      B1: 'Mittelstufe',
      B2: 'Obere Mittelstufe',
      C1: 'Fortgeschritten',
      All: 'A1-C1',
    },
    learning: {
      imageNotAvailable: "Bild nicht verfÃ¼gbar",
      progress: "{current} / {total}",
      prev: "ZurÃ¼ck",
      next: "Weiter",
    },
    quiz: {
      score: "Punkte: {score}",
      progress: "{current} / {total}",
      placeholder: "Gib die {language} Ãœbersetzung ein",
      check: "PrÃ¼fen",
      hint: "Hinweis",
      hintError: "Konnte diesmal keinen Hinweis abrufen.",
      correctAnswer: "Richtige Antwort:",
      nextWord: "NÃ¤chstes Wort",
      finish: "Beenden",
      exampleSentence: "Beispielsatz",
    },
     pronunciation: {
        score: "Punkte: {score}",
        progress: "{current} / {total}",
        instruction: "HÃ¶re zu und nimm dann deine Aussprache auf.",
        listen: "AnhÃ¶ren",
        record: "Aufnehmen",
        recording: "Aufnahme lÃ¤uft...",
        processing: "Verarbeite...",
        speakNow: "Sprich jetzt...",
        correct: "Richtig!",
        incorrect: "Nicht ganz, versuch es noch einmal.",
        correctWordWas: "Das Wort war:",
        youSaid: "Du hast gesagt:",
        nextWord: "NÃ¤chstes Wort",
        finish: "Beenden",
        micError: "Zugriff auf das Mikrofon nicht mÃ¶glich. Bitte aktivieren Sie die Mikrofonberechtigungen in Ihren Browsereinstellungen.",
        recognitionError: "Entschuldigung, ich habe das nicht verstanden. Bitte versuchen Sie es erneut.",
    },
    grammarQuiz: {
        score: "Punkte: {score}",
        progress: "{current} / {total}",
        generating: "Grammatikfrage wird generiert...",
        questionError: "Die nÃ¤chste Frage konnte nicht geladen werden. Bitte versuchen Sie es erneut.",
        tryAgain: "Erneut versuchen",
        correctAnswer: "Richtige Antwort:",
        gettingExplanation: "ErklÃ¤rung wird abgerufen...",
        explanationError: "FÃ¼r diesen Fehler konnte keine ErklÃ¤rung geladen werden.",
        correct: "Richtig!",
        nextQuestion: "NÃ¤chste Frage",
        finishQuiz: "Quiz beenden",
    },
    grammarLearn: {
        grammarRuleNotAvailable: "Grammatikregel nicht verfÃ¼gbar",
        progress: "{current} / {total}",
        prev: "ZurÃ¼ck",
        next: "Weiter",
    },
    results: {
      title: "Quiz abgeschlossen!",
      perfectMessage: "Perfekte Punktzahl!",
      excellentMessage: "Ausgezeichnete Arbeit!",
      goodMessage: "Guter Versuch!",
      practiceMessage: "Ãœbe weiter!",
      score: "Deine Punktzahl: {score} / {total}",
      playAgain: "Nochmal spielen",
    }
  },
  ja: {
    app: {
      title: "èªžå­¦å­¦ç¿’",
      tagline: "AIã§{language}ã‚’ãƒžã‚¹ã‚¿ãƒ¼ã—ã‚ˆã†",
      footer: "å­¦ã³ã€è©¦ã—ã€ç¿’å¾—ã™ã‚‹ã€‚",
      error: "ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚AIãŒãƒ“ã‚¸ãƒ¼çŠ¶æ…‹ã‹ã€APIã‚­ãƒ¼ã«å•é¡ŒãŒã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚",
      loading: "ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æº–å‚™ã—ã¦ã„ã¾ã™...",
      backToMenu: "ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹",
    },
    menu: {
      title: "ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­å®š",
      subtitle: "è¨­å®šã‚’é¸æŠžã—ã¦é–‹å§‹ã—ã¦ãã ã•ã„",
      step1: "ã‚¹ãƒ†ãƒƒãƒ—1ï¼šè¨€èªžã‚’é¸æŠž",
      iWantToLearn: "å­¦ç¿’ã—ãŸã„è¨€èªžï¼š",
      myAppIsIn: "ã‚¢ãƒ—ãƒªã®è¨€èªžï¼š",
      step2: "ã‚¹ãƒ†ãƒƒãƒ—2ï¼šãƒ¬ãƒ™ãƒ«ã‚’é¸æŠž",
      step3: "ã‚¹ãƒ†ãƒƒãƒ—3ï¼šã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠž",
      vocabulary: "å˜èªž",
      grammar: "æ–‡æ³•",
      pronunciation: "ç™ºéŸ³",
      step4: "ã‚¹ãƒ†ãƒƒãƒ—4ï¼šãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠž",
      learn: "å­¦ç¿’",
      learnItems: "{count}é …ç›®",
      quiz: "ã‚¯ã‚¤ã‚º",
      practice: "ç·´ç¿’",
      practiceItems: "{count}é …ç›®",
      quizItems: "é¸æŠžå¼",
      step5: "ã‚¹ãƒ†ãƒƒãƒ—5ï¼šç·´ç¿’ã®é•·ã•ã‚’è¨­å®š",
      quizLength: "{count}å•",
      startSession: "ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹",
      A1: 'åˆå¿ƒè€…',
      A2: 'åˆç´š',
      B1: 'ä¸­ç´š',
      B2: 'ä¸­ä¸Šç´š',
      C1: 'ä¸Šç´š',
      All: 'A1-C1',
    },
    learning: {
      imageNotAvailable: "ç”»åƒãŒã‚ã‚Šã¾ã›ã‚“",
      progress: "{current} / {total}",
      prev: "å‰ã¸",
      next: "æ¬¡ã¸",
    },
    quiz: {
      score: "ã‚¹ã‚³ã‚¢ï¼š{score}",
      progress: "{current} / {total}",
      placeholder: "{language}ã®ç¿»è¨³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
      check: "ãƒã‚§ãƒƒã‚¯",
      hint: "ãƒ’ãƒ³ãƒˆ",
      hintError: "ç¾åœ¨ãƒ’ãƒ³ãƒˆã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚",
      correctAnswer: "æ­£è§£ï¼š",
      nextWord: "æ¬¡ã®å˜èªž",
      finish: "çµ‚äº†",
      exampleSentence: "ä¾‹æ–‡",
    },
    pronunciation: {
        score: "ã‚¹ã‚³ã‚¢: {score}",
        progress: "{current} / {total}",
        instruction: "å˜èªžã‚’èžã„ã¦ã€ã‚ãªãŸã®ç™ºéŸ³ã‚’éŒ²éŸ³ã—ã¦ãã ã•ã„ã€‚",
        listen: "èžã",
        record: "éŒ²éŸ³",
        recording: "éŒ²éŸ³ä¸­...",
        processing: "å‡¦ç†ä¸­...",
        speakNow: "è©±ã—ã¦ãã ã•ã„...",
        correct: "æ­£è§£ï¼",
        incorrect: "æƒœã—ã„ã€ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ï¼",
        correctWordWas: "æ­£è§£ã¯:",
        youSaid: "ã‚ãªãŸã®ç™ºéŸ³:",
        nextWord: "æ¬¡ã®å˜èªž",
        finish: "çµ‚äº†",
        micError: "ãƒžã‚¤ã‚¯ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã§ãƒžã‚¤ã‚¯ã®è¨±å¯ã‚’æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚",
        recognitionError: "ã™ã¿ã¾ã›ã‚“ã€èžãå–ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚",
    },
    grammarQuiz: {
        score: "ã‚¹ã‚³ã‚¢ï¼š{score}",
        progress: "{current} / {total}",
        generating: "æ–‡æ³•å•é¡Œã‚’ç”Ÿæˆä¸­...",
        questionError: "æ¬¡ã®å•é¡Œã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚",
        tryAgain: "å†è©¦è¡Œ",
        correctAnswer: "æ­£è§£ï¼š",
        gettingExplanation: "è§£èª¬ã‚’å–å¾—ä¸­...",
        explanationError: "ã“ã®ã‚¨ãƒ©ãƒ¼ã®è§£èª¬ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚",
        correct: "æ­£è§£ï¼",
        nextQuestion: "æ¬¡ã®å•é¡Œ",
        finishQuiz: "ã‚¯ã‚¤ã‚ºã‚’çµ‚äº†",
    },
    grammarLearn: {
        grammarRuleNotAvailable: "æ–‡æ³•ãƒ«ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“",
        progress: "{current} / {total}",
        prev: "å‰ã¸",
        next: "æ¬¡ã¸",
    },
    results: {
      title: "ã‚¯ã‚¤ã‚ºå®Œäº†ï¼",
      perfectMessage: "ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆã‚¹ã‚³ã‚¢ï¼",
      excellentMessage: "ç´ æ™´ã‚‰ã—ã„æˆç¸¾ã§ã™ï¼",
      goodMessage: "ã‚ˆãã§ãã¾ã—ãŸï¼",
      practiceMessage: "ç·´ç¿’ã‚’ç¶šã‘ã¾ã—ã‚‡ã†ï¼",
      score: "ã‚¹ã‚³ã‚¢ï¼š{score} / {total}",
      playAgain: "ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤",
    }
  },
};

// A helper function to get the correct translation object, falling back to English
export const getTranslations = (lang: UiLanguage): Translations => {
    // A simple deep merge to fill in missing keys from English
    const fallback = i18n.en;
    const selected = i18n[lang as keyof typeof i18n] || fallback;

    const merge = (target: any, source: any) => {
        const output = { ...target };
        for (const key in source) {
            if (source.hasOwnProperty(key)) {
                if (typeof source[key] === 'object' && source[key] !== null && !Array.isArray(source[key])) {
                    output[key] = merge(target[key] || {}, source[key]);
                } else if (target[key] === undefined) {
                    output[key] = source[key];
                }
            }
        }
        return output;
    }

    return merge(selected, fallback) as Translations;
};